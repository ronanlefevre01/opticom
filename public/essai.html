<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Essai OptiCOM – 5 SMS offerts</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0f172a;color:#fff;margin:0}
  .wrap{max-width:720px;margin:40px auto;padding:24px}
  .card{background:#111827;border-radius:14px;padding:22px}
  label{display:block;font-weight:600;margin:12px 0 6px}
  input{width:100%;padding:12px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#fff}
  .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  .hint{color:#94a3b8;font-size:14px;margin:8px 0 16px}
  button{background:#10b981;border:0;color:#fff;font-weight:700;padding:14px 18px;border-radius:10px;cursor:pointer}
  .ok{background:#065f46}
  .err{background:#7f1d1d}
</style>
</head>
<body>
<div class="wrap">
  <h1>Essai gratuit – 5 SMS offerts</h1>
  <p class="hint">Remplissez ce formulaire. Nous créons votre licence d’essai et vous envoyons vos accès par e-mail.</p>

  <div class="card">
    <form id="trialForm">
      <label>Nom du magasin</label>
      <input id="storeName" required>

      <div class="row">
        <div>
          <label>SIRET</label>
          <input id="siret" required>
        </div>
        <div>
          <label>Téléphone</label>
          <input id="phone" required>
        </div>
      </div>

      <div class="row">
        <div>
          <label>E-mail</label>
          <input id="email" type="email" required>
        </div>
        <div>
          <label>Alias expéditeur (3–11 caractères)</label>
          <input id="alias" maxlength="11" placeholder="ex: OPTICOM" required>
        </div>
      </div>

      <p class="hint">En validant, vous demandez une création manuelle d’une licence d’essai (5 SMS).</p>
      <button type="submit" id="submitBtn">Envoyer la demande</button>
      <span id="status" style="margin-left:12px;"></span>
    </form>
  </div>
</div>

<script>
  // Pré-remplissage depuis les query params (depuis l’email)
  const params = new URLSearchParams(location.search);
  const set = (id, key) => { const el = document.getElementById(id); if (params.get(key)) el.value = params.get(key); };
  set('email','email'); set('phone','telephone'); set('storeName','nom');

  document.getElementById('trialForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const status = document.getElementById('status');
    const btn = document.getElementById('submitBtn');
    btn.disabled = true; status.textContent = 'Envoi…';

    const payload = {
      storeName: document.getElementById('storeName').value.trim(),
      siret: document.getElementById('siret').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      email: document.getElementById('email').value.trim(),
      alias: document.getElementById('alias').value.trim(),
      source: 'email-essai'
    };

    // Validation rapide côté client
    if (payload.alias.length < 3 || payload.alias.length > 11) {
      status.textContent = ''; btn.disabled = false;
      alert('Alias expéditeur entre 3 et 11 caractères.');
      return;
    }

    try {
      const res = await fetch('/api/trial-requests', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('HTTP '+res.status);
      status.textContent = '✅ Demande envoyée. Nous revenons vers vous sous peu.';
      status.className = 'ok';
    } catch (err) {
      status.textContent = '❌ Erreur. Réessayez ou contactez support.';
      status.className = 'err';
      btn.disabled = false;
    }
  });
</script>
</body>
</html>
